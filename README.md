# Decompositions playground

Look at the Notebook




# Benchmark

``` ini

BenchmarkDotNet=v0.13.1, OS=ubuntu 20.04
Intel Core i7-7500U CPU 2.70GHz (Kaby Lake), 1 CPU, 4 logical and 2 physical cores
.NET SDK=6.0.100
  [Host]   : .NET 6.0.0 (6.0.21.52210), X64 RyuJIT
  .NET 6.0 : .NET 6.0.0 (6.0.21.52210), X64 RyuJIT

Job=.NET 6.0  Runtime=.NET 6.0

```
|  Method | K | TargetDouble | ToleranceDouble | DustDouble |           Mean |         Error |        StdDev |         Median | Rank |
|-------- |-- |------------- |---------------- |----------- |---------------:|--------------:|--------------:|---------------:|-----:|
| **Process** | **4** |         **0.05** |               **0** |      **1E-06** |       **257.3 μs** |      **24.07 μs** |      **70.96 μs** |       **291.4 μs** |    **4** |
| **Process** | **4** |         **0.05** |               **0** |      **5E-05** |       **247.5 μs** |      **22.71 μs** |      **66.61 μs** |       **277.7 μs** |    **3** |
| **Process** | **4** |         **0.05** |           **1E-06** |      **1E-06** |       **272.1 μs** |      **25.64 μs** |      **75.59 μs** |       **309.4 μs** |    **6** |
| **Process** | **4** |         **0.05** |           **1E-06** |      **5E-05** |       **262.3 μs** |      **17.45 μs** |      **51.17 μs** |       **279.2 μs** |    **4** |
| **Process** | **4** |         **0.05** |           **5E-05** |      **1E-06** |       **564.8 μs** |      **52.86 μs** |     **155.87 μs** |       **656.2 μs** |    **8** |
| **Process** | **4** |         **0.05** |           **5E-05** |      **5E-05** |       **310.8 μs** |      **27.86 μs** |      **82.16 μs** |       **357.3 μs** |    **7** |
| **Process** | **4** |          **0.5** |               **0** |      **1E-06** |       **266.4 μs** |      **20.83 μs** |      **60.77 μs** |       **288.0 μs** |    **5** |
| **Process** | **4** |          **0.5** |               **0** |      **5E-05** |       **255.4 μs** |      **24.81 μs** |      **73.15 μs** |       **271.3 μs** |    **4** |
| **Process** | **4** |          **0.5** |           **1E-06** |      **1E-06** |       **273.9 μs** |      **22.54 μs** |      **65.74 μs** |       **292.2 μs** |    **6** |
| **Process** | **4** |          **0.5** |           **1E-06** |      **5E-05** |       **243.6 μs** |      **22.61 μs** |      **66.32 μs** |       **269.4 μs** |    **3** |
| **Process** | **4** |          **0.5** |           **5E-05** |      **1E-06** |       **271.4 μs** |      **23.16 μs** |      **67.94 μs** |       **307.1 μs** |    **6** |
| **Process** | **4** |          **0.5** |           **5E-05** |      **5E-05** |       **235.9 μs** |      **23.95 μs** |      **70.63 μs** |       **275.2 μs** |    **3** |
| **Process** | **4** |           **50** |               **0** |      **1E-06** |       **253.9 μs** |      **21.56 μs** |      **63.58 μs** |       **294.2 μs** |    **3** |
| **Process** | **4** |           **50** |               **0** |      **5E-05** |       **227.1 μs** |      **26.55 μs** |      **77.86 μs** |       **233.1 μs** |    **2** |
| **Process** | **4** |           **50** |           **1E-06** |      **1E-06** |       **254.7 μs** |      **21.47 μs** |      **63.30 μs** |       **289.3 μs** |    **4** |
| **Process** | **4** |           **50** |           **1E-06** |      **5E-05** |       **288.6 μs** |       **5.77 μs** |       **5.12 μs** |       **288.2 μs** |    **6** |
| **Process** | **4** |           **50** |           **5E-05** |      **1E-06** |       **234.6 μs** |      **25.24 μs** |      **73.22 μs** |       **225.2 μs** |    **3** |
| **Process** | **4** |           **50** |           **5E-05** |      **5E-05** |       **178.4 μs** |      **18.73 μs** |      **53.73 μs** |       **150.4 μs** |    **1** |
| **Process** | **6** |         **0.05** |               **0** |      **1E-06** |     **5,604.4 μs** |     **545.63 μs** |   **1,608.79 μs** |     **6,620.3 μs** |   **11** |
| **Process** | **6** |         **0.05** |               **0** |      **5E-05** |     **5,773.8 μs** |     **656.82 μs** |   **1,852.57 μs** |     **5,634.6 μs** |   **11** |
| **Process** | **6** |         **0.05** |           **1E-06** |      **1E-06** |     **6,095.4 μs** |     **639.45 μs** |   **1,885.45 μs** |     **6,315.8 μs** |   **11** |
| **Process** | **6** |         **0.05** |           **1E-06** |      **5E-05** |     **5,028.9 μs** |     **374.69 μs** |   **1,032.01 μs** |     **5,452.0 μs** |   **10** |
| **Process** | **6** |         **0.05** |           **5E-05** |      **1E-06** |    **27,743.7 μs** |   **1,827.14 μs** |   **4,813.43 μs** |    **26,240.8 μs** |   **16** |
| **Process** | **6** |         **0.05** |           **5E-05** |      **5E-05** |     **7,719.2 μs** |     **612.92 μs** |   **1,807.22 μs** |     **8,663.8 μs** |   **13** |
| **Process** | **6** |          **0.5** |               **0** |      **1E-06** |     **4,952.4 μs** |     **506.25 μs** |   **1,492.69 μs** |     **4,633.9 μs** |   **10** |
| **Process** | **6** |          **0.5** |               **0** |      **5E-05** |     **6,304.8 μs** |     **124.52 μs** |     **122.29 μs** |     **6,289.0 μs** |   **11** |
| **Process** | **6** |          **0.5** |           **1E-06** |      **1E-06** |     **6,693.7 μs** |     **373.10 μs** |   **1,033.85 μs** |     **6,851.3 μs** |   **12** |
| **Process** | **6** |          **0.5** |           **1E-06** |      **5E-05** |     **5,779.8 μs** |     **468.07 μs** |   **1,380.11 μs** |     **6,277.0 μs** |   **11** |
| **Process** | **6** |          **0.5** |           **5E-05** |      **1E-06** |    **12,384.9 μs** |   **1,020.06 μs** |   **3,007.67 μs** |    **14,047.7 μs** |   **15** |
| **Process** | **6** |          **0.5** |           **5E-05** |      **5E-05** |     **7,950.9 μs** |      **34.00 μs** |      **26.55 μs** |     **7,954.9 μs** |   **14** |
| **Process** | **6** |           **50** |               **0** |      **1E-06** |     **4,440.3 μs** |     **498.12 μs** |   **1,468.73 μs** |     **3,457.8 μs** |    **9** |
| **Process** | **6** |           **50** |               **0** |      **5E-05** |     **5,912.8 μs** |     **385.63 μs** |   **1,137.03 μs** |     **6,320.0 μs** |   **11** |
| **Process** | **6** |           **50** |           **1E-06** |      **1E-06** |     **5,720.0 μs** |     **464.87 μs** |   **1,370.67 μs** |     **6,123.5 μs** |   **11** |
| **Process** | **6** |           **50** |           **1E-06** |      **5E-05** |     **5,249.7 μs** |     **490.85 μs** |   **1,447.28 μs** |     **5,537.0 μs** |   **11** |
| **Process** | **6** |           **50** |           **5E-05** |      **1E-06** |     **5,402.4 μs** |     **554.46 μs** |   **1,634.83 μs** |     **6,448.0 μs** |   **11** |
| **Process** | **6** |           **50** |           **5E-05** |      **5E-05** |     **5,182.1 μs** |     **500.25 μs** |   **1,474.99 μs** |     **5,828.3 μs** |   **11** |
| **Process** | **8** |         **0.05** |               **0** |      **1E-06** |   **116,548.6 μs** |  **13,760.23 μs** |  **40,572.34 μs** |    **92,939.9 μs** |   **17** |
| **Process** | **8** |         **0.05** |               **0** |      **5E-05** |    **93,987.1 μs** |   **7,857.58 μs** |  **22,796.26 μs** |    **96,426.8 μs** |   **17** |
| **Process** | **8** |         **0.05** |           **1E-06** |      **1E-06** |   **253,815.2 μs** |  **26,586.39 μs** |  **74,987.37 μs** |   **231,747.6 μs** |   **22** |
| **Process** | **8** |         **0.05** |           **1E-06** |      **5E-05** |    **96,120.3 μs** |   **9,007.93 μs** |  **25,110.52 μs** |    **95,225.5 μs** |   **17** |
| **Process** | **8** |         **0.05** |           **5E-05** |      **1E-06** | **2,406,899.8 μs** | **206,893.19 μs** | **610,029.23 μs** | **2,731,064.0 μs** |   **24** |
| **Process** | **8** |         **0.05** |           **5E-05** |      **5E-05** |   **146,771.8 μs** |  **14,957.45 μs** |  **44,102.38 μs** |   **166,255.5 μs** |   **19** |
| **Process** | **8** |          **0.5** |               **0** |      **1E-06** |   **154,403.1 μs** |  **12,375.68 μs** |  **35,904.11 μs** |   **169,680.6 μs** |   **19** |
| **Process** | **8** |          **0.5** |               **0** |      **5E-05** |   **128,850.5 μs** |   **8,394.57 μs** |  **22,406.82 μs** |   **138,330.7 μs** |   **18** |
| **Process** | **8** |          **0.5** |           **1E-06** |      **1E-06** |   **134,098.8 μs** |  **14,296.30 μs** |  **42,152.96 μs** |   **107,364.6 μs** |   **19** |
| **Process** | **8** |          **0.5** |           **1E-06** |      **5E-05** |   **127,252.6 μs** |   **9,826.33 μs** |  **28,818.91 μs** |   **142,246.0 μs** |   **17** |
| **Process** | **8** |          **0.5** |           **5E-05** |      **1E-06** |   **949,489.4 μs** |  **79,420.25 μs** | **234,172.39 μs** | **1,066,398.0 μs** |   **23** |
| **Process** | **8** |          **0.5** |           **5E-05** |      **5E-05** |   **228,209.1 μs** |   **2,958.15 μs** |   **2,470.19 μs** |   **227,710.4 μs** |   **22** |
| **Process** | **8** |           **50** |               **0** |      **1E-06** |   **145,408.9 μs** |  **11,403.68 μs** |  **33,624.00 μs** |   **163,446.3 μs** |   **19** |
| **Process** | **8** |           **50** |               **0** |      **5E-05** |   **159,102.2 μs** |  **11,603.86 μs** |  **32,918.23 μs** |   **174,521.4 μs** |   **20** |
| **Process** | **8** |           **50** |           **1E-06** |      **1E-06** |   **140,100.5 μs** |  **13,282.42 μs** |  **39,163.52 μs** |   **165,394.1 μs** |   **19** |
| **Process** | **8** |           **50** |           **1E-06** |      **5E-05** |   **161,868.0 μs** |   **3,131.87 μs** |   **2,776.32 μs** |   **162,148.4 μs** |   **21** |
| **Process** | **8** |           **50** |           **5E-05** |      **1E-06** |   **180,585.9 μs** |  **18,488.05 μs** |  **54,512.43 μs** |   **221,461.8 μs** |   **21** |
| **Process** | **8** |           **50** |           **5E-05** |      **5E-05** |   **132,760.6 μs** |  **14,516.74 μs** |  **42,802.92 μs** |   **119,539.9 μs** |   **18** |


## Interesting results

The time required to compute the decompositions increases with the size of $k$, what is expected but decreases with the target! This means that the algorithm is more efficient to decompose bigger amount than smaller amount, perhaps this is because with larger numbers there are more denominations to use.

## Success rate

We consider a failure if the decomposer cannot find at least 50 decomposition candidates. The algorithm has 99.998% success rate for with the following parameters:

```
k = 8
tolerance = 100 sats
dust = 500
target = random between dust and 4_300_000_000;
```

These where the failures
```
target = 3968353356  k = 8  tolerance = 100  dust = 500 results = 44
target = 4227746714  k = 8  tolerance = 100  dust = 500 results = 40
Failure rate = 2E-05
Success rate = 99.998
Finished after 156460.1184ms that is average time 1.564601184ms.
```

Note that even in case of failure it still provides at least 40 valid decompositions.